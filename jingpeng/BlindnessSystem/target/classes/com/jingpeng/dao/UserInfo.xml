<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="userInfo">

	<select id="getUserInfo" parameterType="java.util.HashMap"  resultType="userInfo">
		
		select u.Id as id,
		       u.Org_Id as orgId,
		       u.UserCode as userCode,
		       u.Password as password,
		       u.Name as name,
		       u.RoleType as roleType,
		       u.IsSystemUser as isSystemUser,
		       u.Operator as operator,
		       u.CreateDate as createDate,
		       u.Modifier as modifier,
		       u.ModifyDate as modifyDate,
		       u.IsValidData as isValidData,
		       o.Org_Name as orgName		       
		    FROM User_Info u, Organization_Info o
		    WHERE IsValidData = 1 and
		    o.id = u. Org_Id
		    
		 <if test="userCode != null and userCode != ''">
	
		AND u.UserCode = #{userCode}
		
		</if>
		
	    <if test="password != null and password != ''">
	
		AND u.Password = #{password}
		
		</if>
		         
	</select>
	<insert id="addUser" parameterType="UserInfo">
			insert into User_Info (UserCode,Password,Name,RoleType,Org_Id) values 
		(#{userCode},#{password},#{name},#{roleType},#{orgId});
	
	</insert>
	
<select id="userLogin" parameterType="UserInfo" resultType="UserInfo">
select
id id,
UserCode userCode,
Password password,
Name name,
Org_Id orgId,
RoleType roleType 
from User_Info  
WHERE IsValidData = 1
and
UserCode=#{userCode} and Password=#{password}
</select>

<select id="getUserInfo1" parameterType="java.util.Map" resultType="java.util.Map">
select u.Id i_id,
o.Id orgId,
u.UserCode,
u.Name,
o.Org_Name
 from  User_Info u 
 JOIN Organization_Info o 
 ON o.Id = u.Org_Id  
WHERE IsValidData = 1
<if test="orgId != null and orgId != 1">
and u.Id=#{i_id}
</if>
<if test="orgId == 1">
</if>
</select>

<select id="getUserinfoById" parameterType="java.util.Map" resultType="java.util.Map">
select u.Id i_id,
u.UserCode,
u.Password,
u.Name,
o.Org_Name,
o.Id,
u.RoleType roleType
 from  User_Info u 
 JOIN Organization_Info o 
 ON o.Id = u.Org_Id  
WHERE IsValidData = 1
and u.Id=#{id}
	<if test="orgId != null and orgId != ''">
 and o.Id = #{orgId}
 </if>

</select>

<update id="delUserInfo" parameterType="UserInfo">
UPDATE User_Info SET IsValidData=0 WHERE id = #{id}
</update>

<update id="updateUser" parameterType="UserInfo">
UPDATE User_Info SET 
UserCode=#{userCode},
Password=#{password},
Name=#{name},
RoleType=#{roleType},
Org_Id=#{orgId}
WHERE id = #{id}
</update>

</mapper>